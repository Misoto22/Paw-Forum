{% extends "base.html" %}

{% block content %}
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css"
  rel="stylesheet"
/>

<body class="profile-page">
  <div class="profile-container">
    <div class="profile-content">
      <h1>My Profile - <span>{{ current_user.username }}</span></h1>
      <form method="POST" action="{{ url_for('profile') }}">
        <div class="form-row">
          <label>Username <input type="text" name="username" value="{{ current_user.username }}" /></label>
        </div>
        <div class="form-row">
          <label>Gender
            <select name="gender">
              <option value="Male" {% if current_user.gender == 'Male' %}selected{% endif %}>Male</option>
              <option value="Female" {% if current_user.gender == 'Female' %}selected{% endif %}>Female</option>
              <option value="Other" {% if current_user.gender == 'Other' %}selected{% endif %}>Other</option>
            </select>
          </label>
          <label>Post Code <input type="text" name="postcode" value="{{ current_user.postcode }}" /></label>
        </div>
        <div class="form-row">
          <label>Email Address <input type="email" name="email" value="{{ current_user.email }}" /></label>
          <label>Phone Number <input type="tel" name="phone" value="{{ current_user.phone }}" /></label>
        </div>
        <div class="form-row">
          <label>Pet Type
            <select name="petType" multiple="multiple" class="pet-type-select">
              <option value="Dog" {% if current_user.pet_type and 'Dog' in current_user.pet_type %}selected{% endif %}>Dog</option>
              <option value="Cat" {% if current_user.pet_type and 'Cat' in current_user.pet_type %}selected{% endif %}>Cat</option>
              <option value="Bird" {% if current_user.pet_type and 'Bird' in current_user.pet_type %}selected{% endif %}>Bird</option>
              <option value="Fish" {% if current_user.pet_type and 'Fish' in current_user.pet_type %}selected{% endif %}>Fish</option>
              <option value="Reptile" {% if current_user.pet_type and 'Reptile' in current_user.pet_type %}selected{% endif %}>Reptile</option>
              <option value="Insect" {% if current_user.pet_type and 'Insect' in current_user.pet_type %}selected{% endif %}>Insect</option>
              <option value="Other" {% if current_user.pet_type and 'Other' in current_user.pet_type %}selected{% endif %}>Other</option>
            </select>
          </label>
        </div>
        <input type="hidden" name="user_image" id="user_image" value="{{ current_user.user_image }}">
        <button type="submit" class="save-btn">Save</button>
      </form>
      <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </div>
    <div class="avatar-container">
      <img
        src="{{ url_for('static', filename='image/avatars/' + current_user.user_image) }}"
        alt="User Avatar"
        class="avatar"
        id="current-avatar"
      />
      <div id="avatar-modal" class="modal">
        <div class="modal-content">
          <span class="close-btn">&times;</span>
          <table class="avatar-table">
            {% for i in range(1, 25) %}
              {% if loop.index0 % 4 == 0 %}
                <tr>
              {% endif %}
              <td>
                <img
                  src="{{ url_for('static', filename='image/avatars/avatar' ~ i ~ '.png') }}"
                  alt="Avatar {{ i }}"
                  class="selectable-avatar"
                />
              </td>
              {% if loop.index0 % 4 == 3 %}
                </tr>
              {% endif %}
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script>
    $(document).ready(function () {
      $(".pet-type-select").select2({
        placeholder: "Select pet types",
        allowClear: true,
      });

      var modal = document.getElementById("avatar-modal");
      var avatar = document.getElementById("current-avatar");
      var span = document.getElementsByClassName("close-btn")[0];

      avatar.onclick = function () {
        modal.style.display = "block";
      };

      span.onclick = function () {
        modal.style.display = "none";
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      $(".selectable-avatar").click(function () {
        var selectedAvatarSrc = $(this).attr("src");
        $("#current-avatar").attr("src", selectedAvatarSrc);

        var selectedAvatarFilename = selectedAvatarSrc.split('/').pop();
        $("#user_image").val(selectedAvatarFilename);

        modal.style.display = "none";
      });
    });
  </script>
</body>
{% endblock %}
